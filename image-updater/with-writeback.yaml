apiVersion: argocd-image-updater.argoproj.io/v1alpha1
kind: ImageUpdater
metadata:
  name: version-demo-writeback
  namespace: argocd
spec:
  # Select which Applications this ImageUpdater manages
  applicationRefs:
    - namePattern: "version-demo"

  # Global update settings
  commonUpdateSettings:
    updateStrategy: "semver"
    forceUpdate: false

  # Configuration for specific images
  images:
    - alias: "version-demo"
      imageName: "docker.io/myuser/version-demo"
      # Map the image tag to the helm value 'image.tag'
      manifestTargets:
        helm:
          name: "image.repository"
          tag: "image.tag"

  # Write back changes to Git
  writeBackConfig:
    method: "git"
    gitConfig:
      # Change this to your repository
      repository: "git@github.com:myorg/my-version-demo-repo.git"
      branch: "main"
      # Update the values.yaml file in the helm directory
      writeBackTarget: "helmvalues:./helm/values.yaml"
      commitMessage: "chore(deps): update version-demo to {{ .NewTag }}"
      user: "ArgoCD Image Updater"
      email: "argocd-image-updater@example.com"
